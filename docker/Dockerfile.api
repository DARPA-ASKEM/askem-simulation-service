FROM julia:1.8

WORKDIR /executor
# Install requirements
COPY Manifest.toml  /executor/
COPY Project.toml /executor/
RUN julia -e 'using Pkg; Pkg.activate("."); Pkg.instantiate();'

# Install local package
COPY src/ /executor/src/
RUN julia -e 'using Pkg; Pkg.activate("."); Pkg.resolve();'
RUN julia -e 'using Pkg; Pkg.activate("."); Pkg.precompile();'

EXPOSE 8080
CMD [ "julia", "--threads 4", "-e", "using Pkg; Pkg.activate(\".\"); using Executor; Executor.run!();" ]